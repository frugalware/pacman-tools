.TH "REPOMAN" "1" "January 2007" "Frugalware 0.6" "pacman-tools"
.SH NAME
repoman \- Frugalware's program to maintain/build packages via ssh/rsync
.SH SYNOPSIS
\fBrepoman\fR [\fIglobal options\fR] [\fIcommand\fR] [\fIcommand options\fR]
.SH DESCRIPTION
.BR repoman
is meant for Frugalware developers to upload or delete source
tarballs, fpm packages and generate changelogs.

Also it's a tool for users to automatically build and install packages on the
target host.
.br
Note: \fBrepoman\fR only runs \fIinside\fR a darcs repository.
.SH USAGE
A typical package update should be done as follows:

.TP
0) Configure repoman:

echo 'current_servers=("vmiklos@darcs.frugalware.org:/home/ftp/pub/frugalware/frugalware-current")' > ~/.repoman.conf

echo 'fst_root=~/darcs' >> ~/.repoman.conf

Replace my nick (vmiklos) with your nick and make sure about you have the darcs tree in ~/darcs/current.

If you want to use more than one (conflicting, ie.: current and stable) trees, then please add the <reponame>_pushonly=y option to each repo except one. Example: if the host system is -current and you want to enabled current and stable, then add stable_pushonly="y" to your config.

.TP
1) Get the repo and set defaults.

.BR Note:
We recommend you to use a mirror server and the --partial option!

Example for the first time:

darcs get --partial http://ftp5.frugalware.org/packages/frugalware/pub/frugalware/frugalware-current/

Example for the pacman-tools repo:

darcs get --partial http://ftp5.frugalware.org/packages/frugalware/pub/other/pacman-tools/pacman-tools

mv frugalware-current current

cd current

echo "yourname <email@addr.ess>" > _darcs/prefs/author

echo 'username@darcs.frugalware.org:/home/ftp/pub/frugalware/frugalware-current' > _darcs/prefs/defaultrepo

Or, for the pacman-tools repo:

echo 'username@darcs.frugalware.org:/home/ftp/pub/other/pacman-tools/pacman-tools' > _darcs/prefs/defaultrepo

echo 'push apply-as vmiklos' >> _darcs/prefs/defaults

Note: Here do not substituate my nick (vmiklos) with you nick!

.TP
2) Update the repo.

If you already got the repo a simple 'darcs pull' should be enough.

.TP
3) Make changes and build the package.

Now time to edit the FrugalBuild and make changes.

If you would like to add new file(s) to the source, run this:

darcs add glibc.install

To remove file(s) from the source, run this:

rm at-3.1.8r11-makefile.patch

Or if you would like to rename a file in the source, run this:

darcs mv glibc-2.5-foo.patch glibc-2.5-bar.patch

Then build the packages with 'sudo makepkg -c'.

.TP
4) Recording the changes.

Simply run 'darcs record'.

When recording the patch (if this is a package upgrade), its name must be $pkgname-$pkgver-$pkgrel-$arch (when answering to 'What is the patch name?').

For example:

glibc-2.5-1-i686

This is the same as the full package name without trailing .fpm.

.TP
5) Delete the old source package(s).

If you only do a rebuild, then, of course, skip this step. For example:

repoman del source/base/readline/readline-5.0.tar.gz

.TP
6) Push the FrugalBuild/.install/etc patch.

Here you only have to do a simple 'darcs push'.

This command uploads the changes you made locally to the server.

.TP
7) Upload the new source package(s).

If you only do a rebuild, then, of course, skip this step.

For example:

repoman up zsh-4.2.5.tar.bz2 /source/apps/zsh/

repoman up zsh-doc-4.2.5.tar.bz2 /source/apps/zsh/

NOTE: if the original mirror is fast, then just skip this step and repoman cl
(see later) will download the sources for you.

.TP
8) Upload the new fpm package:

For example (see the 'up' command description for more details!):

repoman up sendmail-8.13.4-2-i686.fpm frugalware-i686/

.TP
9) Delete the old fpm package.

For example:

repoman del frugalware-i686/glibc-2.5-1-i686.fpm

.TP
10) Generate a Changelog, update the .fdb and sql database and download the
missing sources:

For example:

repoman cl base/perl

.SH COMMANDS
.TP
.BI cl|changelog " [repository/]category/package"
Generate a Changelog file from darcs patch comments.
.TP
.BI c|clean " [repository/]category/package"
Wipes out a package from the package database (fdb).
.TP
.BI del|delete " file"
Delete a file from a repo.

Example: repoman del frugalware-i686/glibc-2.5-1-i686.fpm
.TP
.BI ls|list " directory [options]"
List the contents of a remote directory.

Example: repoman ls source/base/db/ -l
.TP
.BI m|merge " package"
Build a package from source and install it. You can configure the build
options in the makepkg_opts directive of /etc/repoman.conf.

By default repoman will install the missing dependencies with pacman-g2, clean up
the leftover work files, install the package, and write the resulting package
to the pacman-g2 package cache.

.TP
.BI up|upload " source [destination]"
Upload a file to a repo. Usually you only need to upload the binary packages,
so the default value (frugalware-<arch>) will be fine for you.

Example: repoman up sendmail-8.13.4-2-i686.fpm frugalware-i686/
.TP
.BI upd|update
Update the repos listed in /etc/repoman.conf. If a repo does not
exist yet, then repoman will download it (it may take some time!).
If you want to blacklist a repo then add <reponame>_pushonly="y" to
/etc/repoman.d/<reponame>.

.TP
.BI s|search " [regexp]"
Search in those FrugalBuilds which are only available in source form. If the
optional regexp parameter omitted, it will list all source-only packages.

.SH OPTIONS
.TP
.B -h|--help
Show the help screen.
.TP
.B -v|--verbose
Give verbose output.
.TP
.B -t|--tree
Specify the source tree to use (ie. "current" or "stable", or "my_custom_repo").
.SH ENVIRONMENT
\fBrepoman\fR utilizes the following environment variable:
.PP
.Vb 2

arch                         Update different architecture of the .fdb
                             than repoman is running on.
.SH AUTHORS
Written by Miklos Vajna and Laszlo Dvornik.
.SH "REPORTING BUGS"
Please report bugs to the <http://bugs.frugalware.org/> bug tracking system.
.SH "SEE ALSO"
.BR darcs (1),
.BR pacman-g2 (8)
